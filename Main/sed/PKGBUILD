#-*- mode:sh -*-
pkgname=sed
pkgver=4.5
pkgrel=1
pkgdesc='GNU stream editor'
arch=('x86_64')
url='https://www.gnu.org/software/sed/'
license=('GPL3')
depends=('glibc' 'acl' 'attr')
makedepends=()
source=("https://ftp.gnu.org/pub/gnu/sed/$pkgname-$pkgver.tar.xz")
groups=('lfs-base')

if [[ -n "$(pacman -Ss ^gettext$ 2>/dev/null)" ]];then
  makedepends+=( 'gettext')
else
  optdepends+=( 'gettext')
fi

prepare(){
  cd $pkgname-$pkgver

  # only do this first time
  if [[ -z $(pacman -Qq sed 2>/dev/null) ]];then
      sed -i 's/usr/tools/' build-aux/help2man
  fi
  sed -i 's/testsuite.panic-tests.sh//' Makefile.in
  
  ./configure --prefix=/usr --bindir=/bin
}

build() {
  cd $pkgname-$pkgver
  make
  make html
}

check() {
  cd $pkgname-$pkgver
  make check || true
}

package() {
  cd $pkgname-$pkgver
  make DESTDIR="$pkgdir" install

  # fix makepkg tools yang mencari di /usr/bin
  install -d -m755 "$pkgdir"/usr/bin
  ln -sv ../../bin/sed "$pkgdir"/usr/bin/sed
  install -d -m755 "$pkgdir"/usr/share/doc/${pkgname}-${pkgver}
  install -m644 doc/sed.html "$pkgdir"/usr/share/doc/${pkgname}-${pkgver}
}

md5sums=('ade8f8c2c548bf41f74db2dcfc37e4e3')
